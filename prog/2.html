<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Otázka 2. Databáze, databázový systém. Hlavní funkce DBS. Historický vývoj DBS. Modely dat. Relační algebra: projekce, selekce, spojení. SQL. &mdash; Otázky na státnice 0.1.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.1.0/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.1.0/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.1.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="Otázky na státnice 0.1.0 documentation" href="../index.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          Otázky na státnice</a>
        <span class="navbar-text navbar-version pull-left"><b>0.0.2</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"></ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Otázka 2. Databáze, databázový systém. Hlavní funkce DBS. Historický vývoj DBS. Modely dat. Relační algebra: projekce, selekce, spojení. SQL.</a><ul>
<li><a class="reference internal" href="#zakladni-pojmy">Základní pojmy</a></li>
<li><a class="reference internal" href="#databazovy-system">Databázový systém</a></li>
<li><a class="reference internal" href="#zakladni-objekty">Základní objekty</a></li>
<li><a class="reference internal" href="#srovnani-vybranych-databazovych-systemu">Srovnání vybraných databázových systémů</a></li>
<li><a class="reference internal" href="#databazove-modely">Databázové modely</a></li>
<li><a class="reference internal" href="#prikaz-select">Příkaz SELECT</a></li>
<li><a class="reference internal" href="#agregacni-funkce">Agregační funkce</a></li>
<li><a class="reference internal" href="#vlastnosti-agregacnich-funkci">Vlastnosti agregačních funkcí</a></li>
<li><a class="reference internal" href="#select-seskupeni-dat-grouping">SELECT - Seskupení dat (Grouping)</a></li>
<li><a class="reference internal" href="#seskupeni-s-podminkou">Seskupení s podmínkou</a></li>
<li><a class="reference internal" href="#exists-a-not-exists">EXISTS a NOT EXISTS</a></li>
<li><a class="reference internal" href="#dalsi-moznosti-jazyka-sql">Další možnosti jazyka SQL</a></li>
<li><a class="reference internal" href="#pohledy-views">Pohledy -Views</a></li>
<li><a class="reference internal" href="#upravitelnost-pohledu">Upravitelnost pohledů</a></li>
<li><a class="reference internal" href="#transakce-v-sql">Transakce v SQL</a></li>
<li><a class="reference internal" href="#ochrana-dat-v-sql">Ochrana dat v SQL</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
              
            
            
            
            
              <li class="hidden-sm">
<div id="sourcelink">
  <a href="../_sources/prog/2.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12">
      
  <div class="section" id="otazka-2-databaze-databazovy-system-hlavni-funkce-dbs-historicky-vyvoj-dbs-modely-dat-relacni-algebra-projekce-selekce-spojeni-sql">
<h1>Otázka 2. Databáze, databázový systém. Hlavní funkce DBS. Historický vývoj DBS. Modely dat. Relační algebra: projekce, selekce, spojení. SQL.<a class="headerlink" href="#otazka-2-databaze-databazovy-system-hlavni-funkce-dbs-historicky-vyvoj-dbs-modely-dat-relacni-algebra-projekce-selekce-spojeni-sql" title="Permalink to this headline">¶</a></h1>
<p>Databáze je souhrn všech uložených dat, potřebných k fungování dané organizace</p>
<p>Databázový řídící systém – (DBS) by měl poskytnout:</p>
<ul class="simple">
<li>definici databáze,</li>
<li>efektivní manipulaci databáze,</li>
<li>ochranu dat,</li>
<li>zotavení se z chyb systému.</li>
</ul>
<div class="section" id="zakladni-pojmy">
<h2>Základní pojmy<a class="headerlink" href="#zakladni-pojmy" title="Permalink to this headline">¶</a></h2>
<p>Když do světa zpracování dat vstoupily počítače, nepřišly s revolučními změnami, které by převrátily naruby všechno, co se používalo dosud. Bylo tomu přesně naopak. Počítačové zpracování dat převzalo staleté zkušenosti úředníků, administrativních pracovníků, účetních, skladníků a všech těch, kteří s hromadami údajů museli zápasit mnohem dříve, než byl sestrojen první počítač. Současné zpracování dat v IS, ale i v jiných aplikacích vyžadujících přístup k většímu množství dat, se řeší databázovou technologií. Databázové programy mají za úkol uchovávat, analyzovat a spravovat data ve strukturovaném tvaru. Cílem takto organizovaných dat je rychlé vyhledání uložených údajů, jednoduchý způsob aktualizace, libovolné vyhodnocování a flexibilní spojování.</p>
</div>
<div class="section" id="databazovy-system">
<h2>Databázový systém<a class="headerlink" href="#databazovy-system" title="Permalink to this headline">¶</a></h2>
<p>Souhrn prostředků, které dovolují relativně pohodlným a bezpečným způsobem manipulovat s uloženými daty (bází dat) - vytvářet, modifikovat nebo aktualizovat je a především v těchto datech vyhledávat požadované informace. Program (lépe řečeno systém programů), kterým se řídí a spravuje báze dat, se obecně označuje jako systém řízení báze dat (SŘBD). Anglicky jsou tyto prostředky označovány jako Database Management System. Termín relační databázový systém se váže ke způsobu organizace dat. Pokud v rámci prostředků poskytovaných databázovým systémem navrhneme určitou konkrétní strukturu zpracovávaných dat a doplníme databázový systém prostředky realizujícími specifické akce nad těmito daty, získáme teprve přímo použitelný počítačový prostředek k uchovávání informací z určité oblasti dění. Takový konkrétní systém se nazývá informační systém nebo někdy aplikace. Pro vlastní použití je ještě potřeba naplnit IS konkrétními daty. Databázový systém umožňuje s daty pracovat dvojím způsobem. Umožňuje člověku, který je alespoň částečně seznámen se základními principy systému a se strukturou uložených dat, přímo zasahovat do těchto dat a poskytuje mu poměrně silné prostředky pro vyhledávání potřebných informací v těchto datech. Poskytuje prostředky, kterými lze připravit ony výše zmíněné specifické akce a specifické povely pro práci s daty - připravit program, který tyto akce či povely realizuje. Častý případ je ten, kdy je uživatel systému téměř úplně izolován od vlastních prostředků databázového systému. Toto uživatelské rozhraní potom může být snáze přizpůsobeno konkrétním potřebám a zvyklostem potencionálních uživatelů IS.</p>
</div>
<div class="section" id="zakladni-objekty">
<h2>Základní objekty<a class="headerlink" href="#zakladni-objekty" title="Permalink to this headline">¶</a></h2>
<p>Součástí databázového systému je jazyk, kterým lze tento databázový systém ovládat. Příkazy jazyka lze provádět ve dvou různých režimech. V základním přímém režimu je vydaný příkaz (pokud je syntakticky správný i logicky proveditelný) bezprostředně proveden a systém očekává další příkaz. Strukturovanou posloupnost těchto příkazů jazyka je možno uložit do textového souboru (běžně se pro něj používá extenze .PRG a termín program) a zadat provedení této posloupnosti příkazů v nepřímém režimu. Provedení programu je možné vyvolat jak z přímého režimu, tak i z jiného programu. Základem každého jazyka je souhrn objektů, se kterými je možné manipulovat nebo které je možné vytvářet. Databázový soubor je složený objekt, který je tvořen posloupností záznamů. Každý záznam obsahuje údaje o jistém objektu reálného světa a je tvořen posloupností položek (polí), v nichž jsou uloženy atributy tohoto objektu. Položka má pevné jméno, pevný typ a nabývá vždy nějaké hodnoty tohoto typu. Seznam položek v jednom záznamu, jejich jména a typy jsou dány při definici databázového souboru a jsou shodné pro všechny záznamy daného databázového souboru. Počet záznamů je proměnný podle uložených dat, databázový soubor může být i prázdný, tj. neobsahuje žádný záznam. Jméno databázového souboru je jménem ve smyslu operačního systému. S položkami souborů se pracuje v zásadě stejně, jako se pracuje s proměnnými v jiných programových jazycích. Nejpodstatnější rozdíl je v tom, že hodnoty položek jsou uložené trvalé údaje na paměťovém médiu. Pro práci s dočasnými pracovními hodnotami je možno používat paměťové proměnné a paměťová pole. Proměnná vzniká nejčastěji přiřazením hodnoty, méně často deklarací, zaniká buď explicitním příkazem nebo vymazáním celé oblasti pro paměťové proměnné. Pole je třeba deklarovat a uvést jeho rozměry.</p>
</div>
<div class="section" id="srovnani-vybranych-databazovych-systemu">
<h2>Srovnání vybraných databázových systémů<a class="headerlink" href="#srovnani-vybranych-databazovych-systemu" title="Permalink to this headline">¶</a></h2>
<p>Mnoho databázových systémů o sobě tvrdí, že jsou nejrychlejší, nejkomplexněji pojaté, dají se nejsnadněji adaptovat na konkrétní podmínky, existuje pro ně největší počet již vyvinutých aplikací, mají nejjednodušší údržbu a jsou tudíž ve výsledném součtu i nejlevnější. Existuje samozřejmě velké množství hledisek, podle kterých je lze posuzovat. Skutečností je, že souhrn dostupných informací nezřídka představuje změť nesourodých polopravd, ve které se nezkušený uživatel těžko orientuje. Z inzerce lze obvykle získat informaci o tom, že ten či onen program je nejlepší, případně že je nabízen téměř zdarma nebo o 5 % levněji. Z propagačních materiálů lze obvykle zjistit cenu a výčet funkcí, které program obsahuje. Na výstavách ho lze letem světem spatřit v chodu, takže lze posoudit barevné provedení a úroveň prezentace firmy. Situaci se pokouší zachraňovat různé recenze programů v odborných počítačových časopisech. Zde autoři v první části obvykle popíší vlastní dojmy a na závěr přiloží tabulku, obsahující výčet voleb menu, funkcí a možností systémem má/nemá. Recenze většinou obsahují popis balení produktu při dodávce, pečlivé hodnocení způsobu instalace, hardwarové požadavky, odlišnosti od minulé verze, řešení nedostatků minulé verze, novinky. Přináší též mnoho obrázků s použitím základních funkcí. Odlišnosti v základním pojetí i funkčních možnostech jednotlivých programů mají za následek, že u jednoho programu je vyzdvihováno to a u druhého kritizováno něco úplně jiného. Kritika nedostatků z pohledu recenzenta se navíc pravidelně míjí s připomínkami uživatelů, odvozenými z praxe. Za víceméně objektivní jsou považovány srovnávací testy, ve kterých jsou testované programy použity k řešení stejného úkolu, porovnávají se stejné funkce. Výstupem je i srovnávací tabulka časové odezvy při zatížení programů většími objemy dat, tabulka možností a funkcí, vybavenosti a v neposlední řadě i cena.</p>
</div>
<div class="section" id="databazove-modely">
<h2>Databázové modely<a class="headerlink" href="#databazove-modely" title="Permalink to this headline">¶</a></h2>
<p>Logická struktura dat se řídí třemi databázovými modely - hierarchickým, síťovým a relačním.</p>
<ul class="simple">
<li>Hierarchický databázový model. Všechny vztahy mezi daty mohou být znázorněny pomocí stromové struktury. Jako příklad může sloužit struktura nějaké firmy. Na nejvyšším stupni stojí Firma, na dalším stupni následují jednotlivé Divize této firmy, na třetím stupni jsou jednotlivá Oddělení atd. Každý element má právě jednoho předchůdce, ale může mít více následovníků. Pouze na nejvyšším stupni existuje jen jeden element (Firma).</li>
<li>Síťový databázový model. Síťový model se vyznačuje tím, že každý prvek může mít více následovníků i předchůdců. Příkladem může být správa půjčovny automobilů se skupinou dat Výpůjčky. Tato skupina je podřízena elementům skupiny Zákazníci s daty zákazníků a Auta s informacemi k vypůjčeným automobilům. S oběma má ovšem stejné vztahy.</li>
<li>Relační databázový model. Nejmodernějším a nejrozšířenějším datovým modelem je model relační. Byl popsán teoretickým matematikem E.F.Coddem s cílem dosažení datové nezávislosti a neporušenosti. Základní myšlenka spočívá v dynamickém řízení vztahů mezi datovými soubory. Relační databáze je tvořena jedním nebo více soubory, které jsou uspořádány do tabulek. Tabulku lze snadno popsat - je určena definovaným počtem sloupců, označovaných jako atributy, a řádků. Jeden sloupec reprezentuje jeden atribut. Každý sloupec (atribut) má specifikován svůj (v rámci dané tabulky jednoznačný) název a je charakterizován oborem hodnot, tj. množinou hodnot, kterých mohou nabývat hodnoty v daném sloupci. Každý řádek reprezentuje instanci datového objektu. Datový objekt je charakterizován množinou atributů (sloupců), instance datového objektu je charakterizována množinou hodnot těchto atributů. V průsečících sloupců a řádků vznikají pole (nebo též položky) databáze. Všechna pole určitého řádku se nazývají věta.</li>
</ul>
<p>Relační algebra. Relační model je založen na přesných výrocích teorie množin a proto umožňuje obzvlášť precizní popis dat. Relační algebra má pro práci s relacemi velký význam. Základními operacemi nad relačními tabulkami jsou projekce, selekce a spojení.</p>
<p>Projekce (project) tabulky definovaná podmnožinou atributů představuje vypuštění některých sloupců neobsažených v požadované množině atributů. Součástí operace projekce je i případné vypuštění duplicitních řádek ve výsledné tabulce. Tabulku lze naopak také rozšířit o sloupec vzniklý nějakou operací nad hodnotami uložených atributů.
Projekce relace R na atributy B: pB(R), B je podmnožina atributů R
Selekce (select) tabulky definovaná podmnožinou definičního oboru relace (tj. logickou podmínkou charakterizující tuto podmnožinu) představuje průnik relace s touto novou podmnožinou.
Selekce relace R podle logické podmínky j: sj(R)
Spojení (join) tabulek je vytvoření nové spojené tabulky na základě shodných hodnot atributů v obou tabulkách (spojení záznamů týkajících se téhož objektu do jednoho záznamu za sebe). Podle způsobu porovnávání hodnot ve spojovaných sloupcích se rozlišují 3 druhy spojení - na rovnost (Equijoin), na nerovnost (Theta join) - nemá praktický význam, vnější - inkluse (Outer join). Pokud výsledná relace obsahuje všechny sloupce z první i druhé tabulky, vyjma sloupce, který byl využit pro spojení, pak toto spojení je označováno jako přirozené (Natural join).
? - spojení relací R a S přes sloupce i a j R (i ? j) S
? je jeden z operátorů: &lt;, &lt;=, &gt;, &gt;=, =</p>
<p>Přirozené spojení (NATURAL JOIN) R*S
Pro každý atribut Ai který se nachází v R i v S, vyber z R x S ty n-tice, pro které platí R.Ai = S.Ai
Vypusť pro každý atribut Ai sloupec S.Ai</p>
<p>Vnější spojení (outer join)
dvou relací umožňuje zahrnout do výsledné relace i ty řádky, pro které neexistuje v druhé relaci stejná hodnota ve společném sloupci; chybějícím hodnotám druhé relace se přiřadí hodnota NULL. Zůstanou tak ve výsledné relaci zachovány i ty řádky, které by se při přirozeném spojení ztratily.
Vnějším spojením lze tedy do výsledku získat i ty n-tice, které s ničím spojit nelze, přičemž zbývající komponenty n-tic se doplní prázdnými hodnotami.
Příklady</p>
<blockquote>
<div>Najdi všechny zaměstnance s platem vyšším než 10 000 Kč.</div></blockquote>
<p>p plat &gt; 10000 (Zaměstnanec)</p>
<blockquote>
<div>Vytvoř seznam obsahující číslo zaměstnance, příjmení, jméno a plat</div></blockquote>
<p>sc_zam, prijmeni, jmeno, plat(Zaměstnanec)</p>
<p>SQL (Structured Query Language)
strukturovaný dotazovací jazyk, který byl určen americkým ústavem pro normalizaci (ANSI) jako standard pro komunikaci s relačními databázemi. SQL je nezávislý na datech, protože se uživatel nemusí starat o fyzické uložení dat. Jazyk SQL se používá pro získání informací z databázových souborů, přičemž požadavky na výběr se specifikují popisně.
1970 - E.F.Codd - definice relačního modelu dat, 1974 - první popis dotazovacího jazyka SEQUEL, 1979 - na trh uveden první relační databázový systém ORACLE, 1981 - INGRES, 1982 - SQL/DS, 1982 - zahájení práce na standardu ANSI SQL, 1983 - DB2, 1986 - schválení normy ANSI SQL, 1987 - schválení normy ISO SQL.
SQL je neprocedurální jazyk (popíšeme jaká data chceme najít, ne jak to má počítač provést - poradí si sám).</p>
</div>
<div class="section" id="prikaz-select">
<h2>Příkaz SELECT<a class="headerlink" href="#prikaz-select" title="Permalink to this headline">¶</a></h2>
<div class="highlight-sql"><div class="highlight"><pre>SELECT [DISTINCT | ALL] {* | [vyraz [AS nove_jmeno]] [,...]}
FROM jmeno_tabulky [alias][,...]
[WHERE podminka]
[GROUP BY seznam_sloupcu]
[HAVING podminka]
[ORDER BY seznam_sloupcu]
</pre></div>
</div>
<p>Příkaz SELECT –základní funkce</p>
<ul class="simple">
<li>SELECT Specifikuje které sloupce mají být zahrnuty ve výsledku.</li>
<li>FROM Specifikuje tabulku(y) která se má použít</li>
<li>WHERE Filtruje řádky</li>
<li>GROUP BY Vytváří skupiny řádků se stejnou hodnotou v daném sloupci</li>
<li>HAVING Filtruje skupiny podle dané podmínky</li>
<li>ORDER BY Specifikuje pořadí hodnot ve výsledku</li>
</ul>
<p>Příklad 6.1 Všechny sloupce, všechny řádky
Zobraz všechny informace o všech zaměstnancích
Znak * lze použít jako zkratku pro &#8216;všechny sloupce&#8217;:</p>
<div class="highlight-sql"><div class="highlight"><pre>SELECT *
FROM zaměstnanec
</pre></div>
</div>
<p>Příklad 6.2 -výběr sloupců –projekce
Zobraz seznam pracovníků a jejich platy</p>
<div class="highlight-sql"><div class="highlight"><pre>SELECT jméno, příjmení, plat
FROM zaměstnanec
</pre></div>
</div>
<p>Příklad 6.3 - Použití DISTINCT
Zobrazte čísla nemovitostí, které si některý klient prohlédl</p>
<div class="highlight-sql"><div class="highlight"><pre>SELECT cNem
FROM prohlídka
DISTINCT eliminuje duplicity:
SELECT DISTINCT cNem
FROM prohlídka
</pre></div>
</div>
<p>Příklad 6.4 -Vypočítané hodnoty
Vypište seznam pracovníků a pro každého uveďte výši ročního platu.</p>
<div class="highlight-sql"><div class="highlight"><pre>SELECT jméno, příjmení, plat*12 AS roční_plat
FROM zaměstnanec
</pre></div>
</div>
<p>Příklad 6.5 - Výběr řádků - selekce
Zobrazte všechny informace o zaměstnancích s platem větším než 10000 Kč</p>
<div class="highlight-sql"><div class="highlight"><pre>SELECT * FROM zaměstnanec
WHERE plat &gt;10000
</pre></div>
</div>
<p>Příklad 6.6 -Výběr řádků
Zobraz údaje o pobočkách se sídlem v Praze nebo v Brně</p>
<div class="highlight-sql"><div class="highlight"><pre>SELECT * FROM Pobočka
WHERE město=&#39;Praha&#39; OR město=&#39;Brno&#39;
</pre></div>
</div>
<p>Příklad 6.7 -interval
Zobrazte údaje o zaměstnancích s platem v rozmezí 9 000 -12000 Kč.</p>
<div class="highlight-sql"><div class="highlight"><pre>SELECT *FROM zaměstnanec
WHERE plat BETWEEN 9000 AND 12000
nebo SELECT *
FROM zaměstnanec
WHERE plat&gt;= 9000 AND plat &lt;=1000
</pre></div>
</div>
<p>lze použít i negaci NOT BETWEEN</p>
<p>Příklad 6.8 -Příslušnost k množině
Zobraz údaje o všech managerech a účetních</p>
<div class="highlight-sql"><div class="highlight"><pre>SELECT *
FROM Zaměstnanec
WHERE PracZar IN (&#39;manager&#39;,&#39;účetní&#39;)
</pre></div>
</div>
<p>nebo</p>
<div class="highlight-sql"><div class="highlight"><pre>SELECT *
FROM zaměstnanec
WHERE PracZar=&#39;manager&#39; OR PracZar=&#39;účetní&#39;
</pre></div>
</div>
<p>IN je efektivnější, obsahuje-li množina více hodnot.
Je možno použít i negaci NOT IN</p>
<p>Příklad 6.9 -Hledání řetězce
SQL má dva speciální symboly
% posloupnost nula nebo více znak ů
_ libovolný jeden znak
Najdi zaměstnance, kteří mají v adrese Ostravu.</p>
<div class="highlight-sql"><div class="highlight"><pre>SELECT *
FROM zaměstnanec
WHERE adresa LIKE &#39;%Ostrava%&#39;
</pre></div>
</div>
<p>Příklad 6.10 -podmínka s použitím NULL
Zobraz detaily všech prohlídek, kde není zaznamenána žádná poznámka</p>
<div class="highlight-sql"><div class="highlight"><pre>SELECT *
FROM prohlídka
WHERE poznámka IS NULL
</pre></div>
</div>
<p>Příklad 6.11 - řazení dle jednoho sloupce
Zobraz seznam zaměstnanců dle výše platu, od nejvyššího</p>
</div>
<div class="section" id="agregacni-funkce">
<h2>Agregační funkce<a class="headerlink" href="#agregacni-funkce" title="Permalink to this headline">¶</a></h2>
<p>ISO standard definuje 5 agregačních funkcí:
* COUNT() vrátí počet hodnot ve specifikovaném sloupci
* SUM() vrátí součet hodnot ve specifikovaném sloupci
* AVG() vrátí průměr hodnot ve specifikovaném sloupci
* MIN() vrátí nejmenší hodnotu ve specifikovaném sloupci
* MAX() vrátí největší hodnotu ve specifikovaném sloupci</p>
</div>
<div class="section" id="vlastnosti-agregacnich-funkci">
<h2>Vlastnosti agregačních funkcí<a class="headerlink" href="#vlastnosti-agregacnich-funkci" title="Permalink to this headline">¶</a></h2>
<p>Každá z funkcí pracuje s jedním sloupcem a vrací jednu hodnotu
COUNT, MIN a MAX se aplikuje na numerické i nenumerické hodnoty,
ale SUM a AVG se mohou použít pouze na numerické hodnoty.
Kromě COUNT(*), každá funkce nejdříve eliminuje hodnoty NULL a pracuje pouze se zbylými hodnotami
COUNT(*) spočítá všechny řádky tabulky bez ohledu na výskyt NULL nebo duplicitních hodnot.
Je možno použít DISTINCT před jménem sloupce za účelem eliminace duplicit.
DISTINCT nemá vliv na MIN/MAX, ale může mít vliv na SUM/AVG.
Agregační funkce mohou být použity pouze v seznamu příkazu SELECT a v klauzuli HAVING.</p>
<p>Příklad 6.12 Použití COUNT(*)
U kolika nemovitostí je požadované nájemné vyšší než 8000 Kč?</p>
<div class="highlight-sql"><div class="highlight"><pre>SELECT COUNT(*) AS počet
FROM nemovitost
WHERE nájem &gt; 8000
</pre></div>
</div>
<p>Příklad 6.13
Kolik různých nemovitostí si klienti prohlédli v březnu?</p>
<div class="highlight-sql"><div class="highlight"><pre>SELECT COUNT(DISTINCT cNem) AS počet
FROM prohlídka
WHERE datum &gt;={1.3.99} AND datum &lt;={31.3.99}
</pre></div>
</div>
<p>(formát datumu není ve všech SQL serverech stejný, např u MySQl funguje &gt;=&#8216;1999-03-31&#8217; ale i jiné formáty)</p>
<p>Příklad 6.14 -Použití COUNT a SUM
Najdi počet managerů a součet jejich platů.</p>
<div class="highlight-sql"><div class="highlight"><pre>SELECT COUNT(cZam) AS počet, SUM(plat) AS PlatCelkem
FROM zaměstnanec
WHERE PracZar =&#39;manager&#39;
</pre></div>
</div>
<p>Příklad 6.15 - Použití MIN, MAX, AVG
Najdi min, maximum a průměrný plat zaměstnanců</p>
<div class="highlight-sql"><div class="highlight"><pre>SELECT MIN(plat) AS MIN, MAX(plat) AS MAX, AVG(plat) AS průměr
FROM zaměstnanec
</pre></div>
</div>
<p>Který zaměstnanec má minimální plat?</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span> <span class="n">prijmeni</span><span class="p">,</span><span class="k">MIN</span><span class="p">(</span><span class="n">plat</span><span class="p">)</span>
<span class="k">FROM</span> <span class="n">Zamestnanec</span>
</pre></div>
</div>
<p>Předchozí příkaz nevrátí správnou hodnotu, nelze míchat ne agregované sloupce s agregovanými.
POZOR správně:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span> <span class="n">prijmeni</span><span class="p">,</span> <span class="n">plat</span> <span class="k">FROM</span> <span class="n">Zamestnanec</span>
<span class="k">WHERE</span> <span class="n">plat</span> <span class="o">=</span> <span class="p">(</span><span class="k">SELECT</span> <span class="k">MIN</span><span class="p">(</span><span class="n">plat</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">Zamestnanec</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="select-seskupeni-dat-grouping">
<h2>SELECT - Seskupení dat (Grouping)<a class="headerlink" href="#select-seskupeni-dat-grouping" title="Permalink to this headline">¶</a></h2>
<p>Agregační funkce můžeme aplikovat na podmnožiny tabulky vytvořené podle výběrového kritéria. Tabulka se konceptuálně rozdělí na skupiny, pro které je hodnota zvoleného sloupce konstantní. Každá položka v seznamu příkazu SELECT musí mít pouze jednu hodnotu v dané skupině a SELECT může obsahovat pouze:
* názvy sloupců
* agregační funkce
* konstanty
* výrazy obsahující kombinaci výše zmíněných</p>
<p>Příklad 6.16 Použití GROUP BY
Najdi počet zaměstnancův každé pobočce a jejich celkový plat</p>
<div class="highlight-sql"><div class="highlight"><pre>SELECT cPob, COUNT(cPob) AS počet, SUM(plat) AS PlatCelkem
FROM zaměstnanec
GROUP BY cPob
ORDER BY cPob
</pre></div>
</div>
</div>
<div class="section" id="seskupeni-s-podminkou">
<h2>Seskupení s podmínkou<a class="headerlink" href="#seskupeni-s-podminkou" title="Permalink to this headline">¶</a></h2>
<p>HAVING se používá ve spojení s GROUP BY na filtrování skupin, které budou vybrány do výsledné tabulky. Je podobný jako WHERE, ale WHERE filtruje jednotlivé řádky, zatímco HAVING filtruje skupiny. Názvy sloupců v HAVING se musí objevit také v seznamu GROUP BY, případně musí být obsaženy v agregačních funkcích.</p>
<p>Příklad 6.17 Použití HAVING
Pro každou pobočku, která má více než jednoho zaměstnance, najdi počet zaměstnancův každé pobočce a součet jejich platů.</p>
<div class="highlight-sql"><div class="highlight"><pre>SELECT cPob,COUNT(cZam)AS PočetZam,SUM(plat) AS PlatCelkem
FROM zaměstnanec
GROUP BY cPob
HAVING COUNT(cZam)&gt;1
ORDER BY cPob
</pre></div>
</div>
<p>Poddotazy
(=subqueries)
Některé SQL dotazy mohou v sobě obsahovat další SELECT - poddotaz
Poddotaz lze použít v části WHERE a HAVING vnějšího SELECTu
Poddotazy mohou být požity i v příkazech
INSERT, UPDATE, a DELETE.
Poddotazy lze využít i v části FROM , na vytvoření dočasné tabulky (např. ...FROM Zamestnanec, (SELECT p.nazev, p.id, a.mesto FROM pobocka p, adresa a WHERE pobocka.psc=mesto.psc) AS pm WHERE .... )</p>
<p>Příklad 7.1 Poddotaz
Najdi zaměstnance, kteří pracují v pražských pobočkách</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span> <span class="n">cZam</span><span class="p">,</span><span class="n">Jmeno</span><span class="p">,</span><span class="n">Prijmeni</span><span class="p">,</span><span class="n">PracZar</span>
<span class="k">FROM</span> <span class="n">Zamestnanec</span>
<span class="k">WHERE</span> <span class="n">cPob</span> <span class="k">IN</span>
<span class="p">(</span><span class="k">SELECT</span> <span class="n">cPob</span>
<span class="k">FROM</span> <span class="n">Pobocka</span>
<span class="k">WHERE</span> <span class="n">mesto</span> <span class="o">=</span><span class="s1">&#39;Praha&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Příklad 7.2 Poddotaz s agregační funkcí
Zobraz jméno,příjmení a plat zaměstnanců,kteří mají plat větší jako průměr a zobraz o kolik</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span> <span class="n">cZam</span><span class="p">,</span><span class="n">Jmeno</span><span class="p">,</span><span class="n">Prijmeni</span><span class="p">,</span><span class="n">PracZar</span><span class="p">,</span>
<span class="n">Plat</span> <span class="o">-</span><span class="p">(</span><span class="k">SELECT</span> <span class="k">avg</span><span class="p">(</span><span class="n">plat</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">Zamestnanec</span><span class="p">)</span> <span class="k">AS</span> <span class="n">Rozdil</span>
<span class="k">FROM</span> <span class="n">Zamestnanec</span>
<span class="k">WHERE</span> <span class="n">Plat</span> <span class="o">&gt;</span><span class="p">(</span><span class="k">SELECT</span> <span class="k">AVG</span><span class="p">(</span><span class="n">Plat</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">Zamestnanec</span><span class="p">)</span>
</pre></div>
</div>
<p>Pravidla pro použití poddotazů</p>
<blockquote>
<div>V poddotazu nelze použít ORDER BY
Seznam sloupců v poddotazu musí sestávat pouze z jednoho sloupce nebo výrazu kromě poddotazů, obsahujících EXISTS
Názvy sloupců se implicitně týkají tabulky která je uvedena za FROM v poddotazu</div></blockquote>
<p>Příklad 7.3 Vhnízděný poddotaz
Zobraz nemovitosti, o které se starají zaměstnanci z Pražské pobočky v Brněnské ulici</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span> <span class="n">cNem</span><span class="p">,</span> <span class="n">Ulice</span><span class="p">,</span> <span class="n">Mesto</span><span class="p">,</span> <span class="n">PSC</span><span class="p">,</span> <span class="n">Typ</span><span class="p">,</span> <span class="n">PocetMistn</span><span class="p">,</span> <span class="n">Najem</span>
<span class="k">FROM</span> <span class="n">Nemovitost</span>
<span class="k">WHERE</span> <span class="n">cZam</span> <span class="k">IN</span>
<span class="p">(</span><span class="k">SELECT</span> <span class="n">cZam</span>
<span class="k">FROM</span> <span class="n">Zamestnanec</span>
<span class="k">WHERE</span> <span class="n">cPob</span> <span class="o">=</span>
<span class="p">(</span><span class="k">SELECT</span> <span class="n">cPob</span>
<span class="k">FROM</span> <span class="n">Pobocka</span> <span class="n">Mesto</span>
<span class="k">WHERE</span> <span class="n">Mesto</span> <span class="o">=</span><span class="s1">&#39;Praha&#39;</span> <span class="k">AND</span> <span class="n">Ulice</span> <span class="k">LIKE</span> <span class="s1">&#39;% Brněnská%&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>ANY,SOME a ALL
ANY a ALL lze použít s poddotazy, které produkují jeden sloupec čísel.
ALL – vrátí TRUE tehdy, když danou podmínku spl ň ují všechny hodnoty vyprodukované poddotazem
ANY – vrátí TRUE, když alespoň jedna z hodnot vyprodukovaná poddotazem splňuje podmínku
Je-li výsledek poddotazu prázdná množina, tak ALL vrátí hodnotu TRUE, ANY vrátí FALSE
SOME lze použít místo ANY</p>
<p>Příklad 7.4 Použití ANY/SOME
Najdi zaměstnance, kteří mají plat větší než některý ze zaměstnanců pobočky P01</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span> <span class="n">cZam</span><span class="p">,</span><span class="n">Jmeno</span><span class="p">,</span><span class="n">Prijmeni</span><span class="p">,</span><span class="n">PracZar</span><span class="p">,</span><span class="n">Plat</span>
<span class="k">FROM</span> <span class="n">Zamestnanec</span>
<span class="k">WHERE</span> <span class="n">Plat</span> <span class="o">&gt;</span>
<span class="k">SOME</span> <span class="p">(</span><span class="k">SELECT</span> <span class="n">Plat</span>
<span class="k">FROM</span> <span class="n">Zamestnanec</span>
<span class="k">WHERE</span> <span class="n">cPob</span> <span class="o">=</span> <span class="s1">&#39;P01&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Příklad 7.5 Použití ALL
Najdi zaměstnance, kteří mají plat větší než všichni zaměstnanci pobočky P01</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span> <span class="n">cZam</span><span class="p">,</span><span class="n">Jmeno</span><span class="p">,</span><span class="n">Prijmeni</span><span class="p">,</span><span class="n">PracZar</span><span class="p">,</span><span class="n">Plat</span>
<span class="k">FROM</span> <span class="n">Zamestnanec</span>
<span class="k">WHERE</span> <span class="n">Plat</span> <span class="o">&gt;</span>
<span class="k">ALL</span> <span class="p">(</span><span class="k">SELECT</span> <span class="n">Plat</span>
<span class="k">FROM</span> <span class="n">Zamestnanec</span>
<span class="k">WHERE</span> <span class="n">cPob</span> <span class="o">=</span> <span class="s1">&#39;P01&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Dotazy na hodnoty z více tabulek
Poddotaz se dá použít v případech, že sloupce ve výsledku pocházejí z jedné tabulky
Pokud sloupce ve výsledku pocházejí z více tabulek, je nutné použít JOIN (a tedy více tabulek v části FROM)
Propojovací sloupce se obvykle specifikují v rámci WHERE</p>
<p>Příklad 7.6 Jednoduchý JOIN
Zobrazte jména klientů a jejich komentář při prohlídce nemovitosti.</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span> <span class="n">K</span><span class="p">.</span><span class="n">cKl</span><span class="p">,</span><span class="n">Jmeno</span><span class="p">,</span><span class="n">Prijmeni</span><span class="p">,</span><span class="n">cNem</span><span class="p">,</span><span class="n">Poznamka</span>
<span class="k">FROM</span> <span class="n">Klient</span> <span class="n">K</span><span class="p">,</span><span class="n">Prohlidka</span> <span class="n">P</span>
<span class="k">WHERE</span> <span class="n">K</span><span class="p">.</span><span class="n">cKl</span> <span class="o">=</span><span class="n">P</span><span class="p">.</span><span class="n">cKl</span>
</pre></div>
</div>
<p>alternativně</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span> <span class="n">K</span><span class="p">.</span><span class="n">cKl</span><span class="p">,</span><span class="n">Jmeno</span><span class="p">,</span><span class="n">Prijmeni</span><span class="p">,</span><span class="n">cNem</span><span class="p">,</span><span class="n">Poznamka</span>
<span class="k">FROM</span> <span class="n">Klient</span> <span class="n">K</span> <span class="k">JOIN</span> <span class="n">Prohlidka</span> <span class="n">P</span> <span class="k">ON</span> <span class="n">K</span><span class="p">.</span><span class="n">cKl</span> <span class="o">=</span><span class="n">P</span><span class="p">.</span><span class="n">cKl</span>
</pre></div>
</div>
<p>Příklad 7.7 JOIN a ORDER BY
Pro každou pobočku zobrazte číslo a jméno zaměstnance kteří se starají o nějakou nemovitost a číslo příslušné nemovitosti.</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span> <span class="n">Z</span><span class="p">.</span><span class="n">cPob</span><span class="p">,</span><span class="n">Z</span><span class="p">.</span><span class="n">cZam</span><span class="p">,</span><span class="n">Jmeno</span><span class="p">,</span><span class="n">Prijmeni</span><span class="p">,</span><span class="n">cNem</span>
<span class="k">FROM</span> <span class="n">Zamestnanec</span> <span class="n">Z</span><span class="p">,</span> <span class="n">Nemovitost</span> <span class="n">N</span>
<span class="k">WHERE</span> <span class="n">Z</span><span class="p">.</span><span class="n">cZam</span> <span class="o">=</span><span class="n">N</span><span class="p">.</span><span class="n">cZam</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">Z</span><span class="p">.</span><span class="n">cPob</span><span class="p">,</span><span class="n">Z</span><span class="p">.</span><span class="n">cZam</span><span class="p">,</span><span class="n">N</span><span class="p">.</span><span class="n">cNem</span>
</pre></div>
</div>
<p>Příklad 7.8 Spojení 3 tabulek
Pro každou pobočku zobraz zaměstnance, kteří se starají o nějakou nemovitost spolu s městem, v kterém se nachází pobočka a s nemovitostmi o které se starají</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span> <span class="n">P</span><span class="p">.</span><span class="n">cPob</span><span class="p">,</span><span class="n">P</span><span class="p">.</span><span class="n">Mesto</span><span class="p">,</span><span class="n">Z</span><span class="p">.</span><span class="n">cZam</span><span class="p">,</span><span class="n">Jmeno</span><span class="p">,</span><span class="n">Prijmeni</span><span class="p">,</span><span class="n">cNem</span>
<span class="k">FROM</span> <span class="n">Pobocka</span> <span class="n">P</span><span class="p">,</span><span class="n">Zamestnanec</span> <span class="n">Z</span><span class="p">,</span><span class="n">Nemovitost</span> <span class="n">N</span>
<span class="k">WHERE</span> <span class="n">P</span><span class="p">.</span><span class="n">cPob</span><span class="o">=</span><span class="n">Z</span><span class="p">.</span><span class="n">cPob</span> <span class="k">AND</span> <span class="n">Z</span><span class="p">.</span><span class="n">cZam</span><span class="o">=</span><span class="n">N</span><span class="p">.</span><span class="n">cZam</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">P</span><span class="p">.</span><span class="n">cPob</span><span class="p">,</span><span class="n">Z</span><span class="p">.</span><span class="n">cZam</span><span class="p">,</span><span class="n">cNem</span>
</pre></div>
</div>
<p>Příklad 7.9 Seskupení podle více sloupců
Pro každou pobočku najdi počet nemovitostí, o
které se starají zaměstnanci</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span> <span class="n">Z</span><span class="p">.</span><span class="n">cPob</span><span class="p">,</span><span class="n">Z</span><span class="p">.</span><span class="n">cZam</span><span class="p">,</span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="k">AS</span> <span class="n">pocet</span>
<span class="k">FROM</span> <span class="n">Zamestnanec</span> <span class="n">Z</span><span class="p">,</span><span class="n">Nemovitost</span> <span class="n">N</span>
<span class="k">WHERE</span> <span class="n">Z</span><span class="p">.</span><span class="n">cZam</span> <span class="o">=</span><span class="n">N</span><span class="p">.</span><span class="n">cZam</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">Z</span><span class="p">.</span><span class="n">cPob</span><span class="p">,</span><span class="n">Z</span><span class="p">.</span><span class="n">cZam</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">Z</span><span class="p">.</span><span class="n">cPob</span><span class="p">,</span><span class="n">Z</span><span class="p">.</span><span class="n">cZam</span>
</pre></div>
</div>
<p>Příklad 7.10 Levé vnější spojení
Zobraz všechny pobočky a k nim nemovitosti které jsou v témže městě jako příslušná pobočka.</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span> <span class="n">P</span><span class="p">.</span><span class="o">*</span><span class="p">,</span><span class="n">N</span><span class="p">.</span><span class="o">*</span>
<span class="k">FROM</span> <span class="n">Pobocka</span> <span class="n">P</span> <span class="k">LEFT</span> <span class="k">OUTER</span> <span class="k">JOIN</span> <span class="n">Nemovitost</span> <span class="n">N</span> <span class="k">ON</span> <span class="n">P</span><span class="p">.</span> <span class="n">Mesto</span> <span class="o">=</span><span class="n">N</span><span class="p">.</span><span class="n">Mesto</span> <span class="k">FULL</span> <span class="k">OUTER</span> <span class="k">JOIN</span>
</pre></div>
</div>
<p>Příklad 7.11 Pravé vnější spojení
Zobraz všechny nemovitosti a ke každé nemovitosti také pobočku, ležící v témž městě
.. code-block:: sql</p>
<blockquote>
<div>SELECT P.*,N.*
FROM Pobocka P RIGHT OUTER JOIN Nemovitost N ON P.Mesto =N.Mesto</div></blockquote>
<p>Příklad 7.12
Pro každou pobočku zobraz všechny zaměstnance a ke každému zaměstnanci také číslo nemovitostí o které se stará</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span> <span class="n">Z</span><span class="p">.</span><span class="n">cPob</span><span class="p">,</span><span class="n">Z</span><span class="p">.</span><span class="n">cZam</span><span class="p">,</span><span class="n">Jmeno</span><span class="p">,</span><span class="n">Prijmeni</span><span class="p">,</span><span class="n">cNem</span>
<span class="k">FROM</span> <span class="n">Zamestnanec</span> <span class="n">Z</span> <span class="k">LEFT</span> <span class="k">OUTER</span> <span class="k">JOIN</span> <span class="n">Nemovitost</span> <span class="n">N</span> <span class="k">ON</span> <span class="n">Z</span><span class="p">.</span><span class="n">cZam</span> <span class="o">=</span><span class="n">N</span><span class="p">.</span><span class="n">cZam</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">Z</span><span class="p">.</span><span class="n">cPob</span><span class="p">,</span><span class="n">Z</span><span class="p">.</span><span class="n">cZam</span><span class="p">,</span><span class="n">N</span><span class="p">.</span><span class="n">cNem</span>
</pre></div>
</div>
<p>Příklad 7.13
Pro každou pobočku zobraz všechny zaměstnance a ke každému zaměstnanci také
počet nemovitostí o které se stará</p>
</div>
<div class="section" id="exists-a-not-exists">
<h2>EXISTS a NOT EXISTS<a class="headerlink" href="#exists-a-not-exists" title="Permalink to this headline">¶</a></h2>
<p>EXISTS a NOT EXISTS lze použít pouze s poddotazy
Jako výsledek produkují pouze true/false
True právě tehdy, když existuje alespoň jeden řádek v tabulce, kterou vrátí poddotaz. False právě tehdy,když poddotaz vrátí prázdnou tabulku. Protože EXISTS testuje pouze existenci řádků ve výsledné tabulce poddotazu, výsledek poddotazu může obsahovat libovolný počet sloupců</p>
<p>Příklad 7.14 Použití EXISTS
Najdi zaměstnance,kteří pracují v pražskýchpobočkách</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span> <span class="n">cZam</span><span class="p">,</span><span class="n">Jmeno</span><span class="p">,</span><span class="n">Prijmeni</span><span class="p">,</span><span class="n">PracZar</span>
<span class="k">FROM</span> <span class="n">Zamestnanec</span> <span class="n">Z</span>
<span class="k">WHERE</span> <span class="k">EXISTS</span> <span class="p">(</span><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">Pobocka</span> <span class="n">P</span> <span class="k">WHERE</span> <span class="n">Z</span><span class="p">.</span><span class="n">cPob</span><span class="o">=</span><span class="n">P</span><span class="p">.</span><span class="n">cPob</span> <span class="k">AND</span> <span class="n">Mesto</span><span class="o">=</span><span class="s1">&#39;Praha&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Podmínka Z.cPob =P.cPob je nutná aby se uvažovali správné záznamy v pobočce pro každého zaměstnance
Kdybychom tuto podmínku vypustili, tak bychom v poddotazu dostali všechny záznamy Zamestnance:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span> <span class="o">*</span>
<span class="k">FROM</span> <span class="n">Pobocka</span> <span class="k">WHERE</span> <span class="n">Mesto</span><span class="o">=</span><span class="s1">&#39;Praha&#39;</span>
</pre></div>
</div>
<p>Podmínka by byla vždy TRUE a dotaz by byl:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span> <span class="n">cZam</span><span class="p">,</span><span class="n">Jmeno</span><span class="p">,</span><span class="n">Prijmeni</span><span class="p">,</span><span class="n">PracZar</span>
<span class="k">FROM</span> <span class="n">Zamestnanec</span>
<span class="k">WHERE</span> <span class="k">TRUE</span>
</pre></div>
</div>
<p>Příklad 7.14b Jiná formulace dotazu z Příkladu 7.14</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span> <span class="n">cZam</span><span class="p">,</span><span class="n">Jmeno</span><span class="p">,</span><span class="n">Prijmeni</span><span class="p">,</span><span class="n">PracZar</span>
<span class="k">FROM</span> <span class="n">Zamestnanec</span> <span class="n">Z</span><span class="p">,</span><span class="n">Pobocka</span> <span class="n">P</span>
<span class="k">WHERE</span> <span class="n">Z</span><span class="p">.</span><span class="n">cPob</span><span class="o">=</span><span class="n">P</span><span class="p">.</span><span class="n">cPob</span> <span class="k">AND</span> <span class="n">Mesto</span><span class="o">=</span><span class="s1">&#39;Praha&#39;</span>
</pre></div>
</div>
<p>Příklad 7.15 Použití UNION
Zobrazte města, kde je pobočka nebo nemovitost.</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span> <span class="n">Mesto</span>
<span class="k">FROM</span> <span class="n">Pobocka</span>
<span class="k">WHERE</span> <span class="n">Mesto</span> <span class="k">IS</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">)</span>
<span class="k">UNION</span>
<span class="p">(</span><span class="k">SELECT</span> <span class="n">Mesto</span>
<span class="k">FROM</span> <span class="n">Nemovitost</span>
<span class="k">WHERE</span> <span class="n">Mesto</span> <span class="k">IS</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="dalsi-moznosti-jazyka-sql">
<h2>Další možnosti jazyka SQL<a class="headerlink" href="#dalsi-moznosti-jazyka-sql" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Úpravy hodnot v databázi</li>
<li>Odstranění hodnot</li>
<li>Pohledy</li>
<li>Transakce</li>
<li>Řízení přístupu k datům</li>
</ul>
<p>Modifikace dat - UPDATE</p>
<div class="highlight-sql"><div class="highlight"><pre>UPDATE JménoTabulky
SET JménoSloupce1=hodnota1 [,JménoSloupce2=hodnota2...]
[WHERE Podmínka]
</pre></div>
</div>
<p>JménoTabulky může být jméno tabulky nebo upravitelného pohledu
SET specifikuje názvy sloupců, jejichž hodnoty mají být modifikovány</p>
<p>UPDATE WHERE je volitelné:
není-li uvedeno, tak se modifikují všechny hodnoty vyjmenovaných sloupců
je-li uvedeno,tak se modifikují hodnoty pouze těch řádků, které vyhovují zadané podmínce</p>
<p>Příklad 8.1 Modifikace hodnot 1 sloupce
Máme zvýšit o 3% plat všem zaměstnancům.</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">UPDATE</span> <span class="n">Zamestnanec</span>
<span class="k">SET</span> <span class="n">Plat</span> <span class="o">=</span><span class="n">Plat</span><span class="o">*</span><span class="mi">1</span><span class="p">.</span><span class="mi">03</span>
</pre></div>
</div>
<p>Máme zvýšit o 5% plat všem managerům.</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">UPDATE</span> <span class="n">Zamestnanec</span>
<span class="k">SET</span> <span class="n">Plat</span> <span class="o">=</span><span class="n">Plat</span><span class="o">*</span><span class="mi">1</span><span class="p">.</span><span class="mi">05</span>
<span class="k">WHERE</span> <span class="n">PracZaR</span> <span class="o">=</span><span class="s1">&#39;Manager&#39;</span>
</pre></div>
</div>
<p>Příklad 8.2 Modifikace hodnot více sloupců
Uprav pracovní zařazení pracovníka Oskara Pilného
(cZam=&#8217;Z0102&#8217;) na managera a uprav jeho plat na 30000.</p>
<p>Odstranění dat - DELETE</p>
<div class="highlight-sql"><div class="highlight"><pre>DELETE FROM JménoTabulky
[WHERE podmínka]
</pre></div>
</div>
<p>JménoTabulky může být jméno základní tabulky nebo pohledu
Podmínka je volitelná
Není-li podmínka uvedena, tak se odstraní všechny řádky tabulky
Je-li podmínka uvedená,tak se odstraní pouze ty řádky, pro které je podmínka splněná.</p>
<p>Příklad 8.3 - DELETE
Vymažte všechnyřádky tabulky Prohlidka, týkající se nemovitosti N0001.</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">DELETE</span> <span class="k">FROM</span> <span class="n">Prohlidka</span>
<span class="k">WHERE</span> <span class="n">cNem</span> <span class="o">=</span><span class="s1">&#39;N0001&#39;</span>
</pre></div>
</div>
<p>POZOR: DELETE FROM Prohlidka
Vymaže všechny řádky tabulky Prohlidka</p>
</div>
<div class="section" id="pohledy-views">
<h2>Pohledy -Views<a class="headerlink" href="#pohledy-views" title="Permalink to this headline">¶</a></h2>
<p>Pohled je dynamický výsledek jedné nebo více relačních operací realizovaných nad základními relacemi. Virtuální relace která vlastně neexistuje v databázi, ale vytvoří se na vyžádání v okamihu vyžádání. Obsah pohledu je definován jako dotaz na jednu nebo více základních relací. Všechny operace nad pohledem jsou automaticky transformovány do operací nad relacemi z kterých byl pohled odvozen. Pohled je dotaz, uložený v databázi jako trvalý objekt. Jako pojmenovaný pohled můžeme uložit prakticky libovolný příkaz SELECT.</p>
<p>Obvyklé Příklady pohledů:
* podmnožina řádků nebo sloupců zákl. tabulky
* spojení tabulek
* statistický souhrn vytvořený ze zákl.tabulky
* kombinace pohledů</p>
<p>Výhody pohledů
* Soustřeďují potřebná data pro uživatele
* Skrývají složitost podkladových dat
* Zjednodušují správu uživatelských oprávnění
* Definují uspořádání dat pro export do jiných aplikací</p>
<p>Vytvoření pohledu - CREATE VIEW</p>
<div class="highlight-sql"><div class="highlight"><pre>CREATE VIEW jméno_pohledu [(jméno_sloupce[,...])] AS DefinujícíDotaz
[WITH [CASCADED |LOCAL]CHECK OPTION]
</pre></div>
</div>
<p>Může přiřadit jméno každému sloupci pro každý sloupec v pohledu.
Je-li seznam sloupců specifikován,musí mít stejný počet položek jako je
počet sloupců produkovaný v rámci DefinujícíhoDotazu
Chybí-li,každý sloupec má jméno příslušného sloupce z DefinujícíhoDotazu.
Seznam musí být specifikován, může-li vzniknout nejasnost týkající se jména
sloupce.
WITH CHECK OPTION zajišťuje, že když řádek nesplňuje WHERE klauzuli
definujícího dotazu, tak se nepřidá do příslušné základní tabulky</p>
<p>Příklad 8.4 - Create View
Vytvořte pohled tak, aby manager pobočky P01 viděl detaily pouze pracovníků své pobočky.</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">CREATE</span> <span class="k">VIEW</span> <span class="n">Zam01</span> <span class="k">AS</span> <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">Zamestnanec</span>
<span class="k">WHERE</span> <span class="n">cPob</span> <span class="o">=</span><span class="s1">&#39;P01&#39;</span>
<span class="k">WITH</span> <span class="k">CHECK</span> <span class="k">OPTION</span>
</pre></div>
</div>
<p>Příklad 8.5 - Create View
Vytvoř pohled na údaje zaměstnanců pobočky P01 s vyloučením platu.</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">CREATE</span> <span class="k">VIEW</span> <span class="n">Zam01X</span>
<span class="k">AS</span> <span class="k">SELECT</span> <span class="n">cZam</span><span class="p">,</span><span class="n">Jmeno</span><span class="p">,</span><span class="n">Prijmeni</span><span class="p">,</span><span class="n">PracZar</span>
<span class="k">FROM</span> <span class="n">Zamestnanec</span>
<span class="k">WHERE</span> <span class="n">cPob</span> <span class="o">=</span><span class="s1">&#39;P01&#39;</span>
</pre></div>
</div>
<p>Příklad 8.6
Vytvoř pohled,kde bude přehled zaměstnanců, kteří se starají o nějakou nemovitost,číslo příslušné pobočky ve které pracují, cZam a počet nemovitostí, o které se každý stará.</p>
<div class="highlight-sql"><div class="highlight"><pre>CREATE VIEW Přehled (cPob,cZam,pocet)
AS SELECT Z.cPob,Z.cZam,COUNT(*)
FROM Zamestnanec Z,Nemovitost N
WHERE Z.cZam=N.cZam
GROUP BY Z.cPob,Z.cZam
</pre></div>
</div>
<p>Odstranění pohledu -DROP VIEW</p>
<div class="highlight-sql"><div class="highlight"><pre>DROP VIEW JménoPohledu
[RESTRICT |CASCADE]
</pre></div>
</div>
<p>Odstraní z databáze definici pohledu
Příklad:[[code format=&#8221;sql&#8221;]] DROP VIEW Zam3code</p>
<p>Postup při použití pohledů
O kolik nemovitostí se stará každý ze zaměstnanců pobočky P01
(pohled Prehled z Příkladu 8.6)?</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span> <span class="n">cZam</span><span class="p">,</span><span class="n">pocet</span>
<span class="k">FROM</span> <span class="n">Prehled</span>
<span class="k">WHERE</span> <span class="n">cPob</span> <span class="o">=</span><span class="s1">&#39;P01&#39;</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">cZam</span>
</pre></div>
</div>
<p>Jak to DB systém zpracuje:
(a) Jména sloupců v seznamu příkazu SELECT se nahradí jmény sloupců v příslušném definujícím dotazu:</p>
<p>SELECT Z.cZam AS cZam,COUNT(*) AS počet</p>
<ol class="loweralpha simple" start="2">
<li>Jména pohledů v části FROM se nahradí příslušnými jmény části FROM definujícího dotazu:</li>
</ol>
<p>FROM Zamestnanec Z, Nemovitost N</p>
<ol class="loweralpha simple" start="3">
<li>WHERE z uživatelského dotazu se skombinuje s WHERE definujícího dotazu pomocí AND:</li>
</ol>
<p>WHERE Z.cZam=N.cZam AND cPob=’P01’</p>
<ol class="loweralpha simple" start="4">
<li>GROUP BY a HAVING se zkopírují z definujícího dotazu :</li>
</ol>
<p>GROUP BY Z.cPob,Z.cZam</p>
<ol class="loweralpha simple" start="5">
<li>ORDER BY se zkopíruje z dotazu přičemž se jména sloupců nahradí jmény sloupců definujícího dotazu:</li>
</ol>
<p>ORDER BY Z.cZam</p>
<ol class="loweralpha simple" start="6">
<li>Konečný sloučený dotaz se vykoná:</li>
</ol>
<p>SELECT Z.cZam AS cZam,COUNT(*)AS Počet
FROM Zamestnanec Z,Nemovitost N
WHERE Z.cZam=N.cZam AND cPob=&#8217;P01&#8217;
GROUP BY Z.cPob,Z.cZam
ORDER BY Z.cZam</p>
<p>Omezení pohledů
Definice a použití pohledů má určitá omezení:
(a) je-li sloupec v pohledu založen na agregační funkci:</p>
<ul class="simple">
<li>Sloupec lze použít pouze v části SELECT a ORDER BY dotazů,přistupujících k pohledu</li>
<li>Sloupec nelze použít v části WHERE ani nemůže být argumentem agregační funkce žádného dotazu založeného na pohledu</li>
</ul>
<p>Například následující dotazy jsou chybné:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span> <span class="k">COUNT</span><span class="p">(</span><span class="n">pocet</span><span class="p">)</span>
<span class="k">FROM</span> <span class="n">Prehled</span>
<span class="k">SELECT</span> <span class="o">*</span>
<span class="k">FROM</span> <span class="n">Prehled</span>
<span class="k">WHERE</span> <span class="n">pocet</span> <span class="o">&gt;</span><span class="mi">2</span>
</pre></div>
</div>
<p>(b) Pohled používající seskupení nelze spojit se základní tabulkou nebo s jiným pohledem
Například pohled Přehled</p>
<div class="highlight-sql"><div class="highlight"><pre>CREATE VIEW Přehled (cPob,cZam,pocet)
AS SELECT Z.cPob,Z.cZam,COUNT(*)
FROM Zamestnanec Z,Nemovitost NWHERE Z.cZam =N.cZam
GROUP BY Z.cPob,Z.cZam
</pre></div>
</div>
</div>
<div class="section" id="upravitelnost-pohledu">
<h2>Upravitelnost pohledů<a class="headerlink" href="#upravitelnost-pohledu" title="Permalink to this headline">¶</a></h2>
<p>Všechny úpravy základní tabulky se promítnou do všech pohledůvytvořených nad touto tabulkou
Analogicky bychom očekávali,že je-li upraven pohled, tak se příslušná změna objeví v základní tabulce.</p>
<p>Uvažujme pohled Prehled. Pokusíme-li se přidat záznam,že v pobočce P01 zaměstnanec Z0006 se stará o 2 nemovitosti:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">Prehled</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="s1">&#39;P01&#39;</span><span class="p">,</span><span class="s1">&#39;SG5&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>To by ale znamenalo,že máme přidat 2 záznamy do tabulky Nemovitost, kde bude také uvedeno o které nemovitosti se stará (jejich identifikace) –to ale neznáme</p>
<p>ISO specifikuje pohledy, které musí být upravitelné
Pohled je upravitelný právě tehdy, když:</p>
<ul class="simple">
<li>není použito DISTINCT</li>
<li>Každý prvek v seznamu v části SELECT definujícího dotazu je název sloupce a žádný sloupec se nevyskytuje více než jedenkrát</li>
<li>FROM specifikuje pouze jednu tabulku a vylučuje pohledy založené na join,union,intersection nebo difference.</li>
<li>Není použit vhnízděný SELECT odkazující se na vnější tabulku.</li>
<li>Není použito GROUP BY nebo HAVING .</li>
<li>Každý řádek přidaný prostřednictvím pohledu, musí splňovat integritní omezení základní tabulky.</li>
</ul>
<p>Aby pohled byl upravitelný,musí DBMS být schopen identifikovat příslušný řádek nebo sloupec v základní tabulce.</p>
</div>
<div class="section" id="transakce-v-sql">
<h2>Transakce v SQL<a class="headerlink" href="#transakce-v-sql" title="Permalink to this headline">¶</a></h2>
<p>Transakce je logická jednotka práce sestávající z jednoho nebo více SQL příkazů které jsou atomické z hlediska zotavení se z chyb.
Změny,které realizuje jedna transakce,nejsou viditelné pro ostatní konkurenčně probíhající transakce, pokud daná transakce neskončí
Transakce je i jednotka zotavení se z chyb
Každá změna v DB se zapisuje do transakčního protokolu –„logu“
Při výpadku systému DBS automaticky obnoví data pomocí dat v transakčním logu.</p>
<p>Vytvoření transakce</p>
<div class="highlight-sql"><div class="highlight"><pre>BEGIN TRANSACTION
Příkaz1
Příkaz2
COMMIT resp.
ROLLBACK
</pre></div>
</div>
<p>COMMIT končí transakci úspěšně a změny jsou trvale zaznamenány
ROLLBACK přeruší transakci a všechny změny se anulují, DB se vrátí do stavu před transakcí</p>
</div>
<div class="section" id="ochrana-dat-v-sql">
<h2>Ochrana dat v SQL<a class="headerlink" href="#ochrana-dat-v-sql" title="Permalink to this headline">¶</a></h2>
<p>Privilegia (oprávnění) uživatelů
Privilegia jsou akce, které uživatel může realizovat nad základní tabulkou nebo pohledem: SELECT INSERT UPDATE DELETE REFERENCES</p>
<p>INSERT/UPDATE/REFERENCES může být omezeno na vyjmenované sloupce.
Vlastník tabulky musí udělit ostatním uživatelům potřebná privilegia použitím
Na vytvoření pohledu musí uživatel mít SELECT privilegium na všechny tabulky nad kterými vytváří pohled a REFERENCES privilegium na jmenované sloupce.</p>
<p>Udělení práv v SQL - GRANT</p>
<div class="highlight-sql"><div class="highlight"><pre>GRANT {seznam_privilegií |ALL PRIVILEGES}
ON jméno_objektu
TO {seznam_autorizační_id|PUBLIC}
[WITH GRANT OPTION]
</pre></div>
</div>
<p>ALL PRIVILEGES udělí všechna privilegia
PUBLIC umožňuje přístup všem
jméno_objektu může být základní tabulka,pohled,doména
WITH GRANT OPTION umožňuje odevzdat privilegia</p>
<p>Příklad 8.7 - GRANT</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">GRANT</span> <span class="k">ALL</span> <span class="k">PRIVILEGES</span>
<span class="k">ON</span> <span class="n">zamestnanec</span>
<span class="k">TO</span> <span class="n">manager</span> <span class="k">WITH</span>
<span class="k">GRANT</span> <span class="k">OPTION</span> <span class="k">GRANT</span> <span class="k">SELECT</span><span class="p">,</span> <span class="k">UPDATE</span> <span class="p">(</span><span class="n">salary</span><span class="p">)</span>
<span class="k">ON</span> <span class="n">zamestnanec</span>
<span class="k">TO</span> <span class="k">admin</span>
<span class="k">GRANT</span> <span class="k">SELECT</span>
<span class="k">ON</span> <span class="n">pobocka</span>
<span class="k">TO</span> <span class="k">PUBLIC</span>
</pre></div>
</div>
<p>Odebrání práv v SQL - REVOKE
REVOKE odebere privilegia udělená příkazem GRANT</p>
<div class="highlight-sql"><div class="highlight"><pre>REVOKE [GRANT OPTION FOR] {seznam_privilegií |ALL PRIVILEGES}
ON jméno_objektu
FROM {seznam_autoriz_id |PUBLIC}
[RESTRICT |CASCADE]
</pre></div>
</div>
<p>Příklad 8.8 -REVOKE</p>
<div class="highlight-sql"><div class="highlight"><pre>REVOKE SELECT
ON pobočka
FROM PUBLIC REVOKE ALL PRIVILEGES
ON zamestnanec FROM zástupce
</pre></div>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2014, Michael Kutý.<br/>
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2.3.<br/>
    </p>
  </div>
</footer>
  </body>
</html>